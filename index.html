<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KrovionX</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <p class="logo">KrovionX</p>
        <nav>
            <a href="index.html">Home</a>
            <a href="Creator.html">Creator</a>
            <a href="contact.html">Contact</a>
        </nav>
        <div class="nav-tools">
            <select id="sortSelect">
                <option value="default">Sort by...</option>
                <option value="title-asc">Title (A-Z)</option>
                <option value="title-desc">Title (Z-A)</option>
            </select>
            <input type="text" id="searchInput" placeholder="Search for a game...">
            <select id="genreSelect">
                <option value="all">Filter genres</option>
            </select>
        </div>
    </header>
    
    <div class="background-container">
        <div class="background-image" id="bg1"></div>
        <div class="background-image" id="bg2"></div>
    </div>
    <div class="overlay"></div>

    <main class="content" id="game-list-container">
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const gameListContainer = document.getElementById('game-list-container');
            const searchInput = document.getElementById('searchInput');
            const sortSelect = document.getElementById('sortSelect');
            const genreSelect = document.getElementById('genreSelect');
            let allGames = [];

            fetch('games.json')
                .then(response => response.json())
                .then(games => {
                    allGames = games;

                    // Build genres dropdown
                    const genreSet = new Set();
                    games.forEach(game => {
                        if (Array.isArray(game.genre)) {
                            game.genre.forEach(g => genreSet.add(g.trim()));
                        } else if (typeof game.genre === "string") {
                            genreSet.add(game.genre.trim());
                        }
                    });
                    genreSet.forEach(genre => {
                        const opt = document.createElement("option");
                        opt.value = genre;
                        opt.textContent = genre;
                        genreSelect.appendChild(opt);
                    });

                    updateDisplay();
                })
                .catch(error => console.error('Error fetching data:', error));

            function updateDisplay() {
                let gamesToDisplay = [...allGames];

                const selectedGenre = genreSelect.value;
                if (selectedGenre !== "all") {
                    gamesToDisplay = gamesToDisplay.filter(game => 
                        Array.isArray(game.genre) && game.genre.includes(selectedGenre)
                    );
                }

                const sortBy = sortSelect.value;
                if (sortBy === 'title-asc') {
                    gamesToDisplay.sort((a, b) => a.title.localeCompare(b.title));
                } else if (sortBy === 'title-desc') {
                    gamesToDisplay.sort((a, b) => b.title.localeCompare(a.title));
                }

                const searchTerm = searchInput.value.toLowerCase().trim();
                if (searchTerm) {
                    gamesToDisplay = gamesToDisplay.filter(game => game.title.toLowerCase().includes(searchTerm));
                }
                displayGames(gamesToDisplay);
            }

            function displayGames(games) {
                gameListContainer.innerHTML = games.length ? '' : '<p class="no-results">No games found.</p>';
                games.forEach(game => {
                    const gameItemHTML = `
                        <div class="game-bar">
                            <a href="game.html?id=${game.id}" data-bg="Images/${game.bg}">
                                <img src="Images/${game.thumbnail}" alt="${game.title} Thumbnail">
                                <div class="game-info">
                                    <h3>${game.title}</h3>
                                    <p>${game.alt_title}</p>
                                </div>
                            </a>
                        </div>
                    `;
                    gameListContainer.innerHTML += gameItemHTML;
                });

                document.querySelectorAll(".game-bar a").forEach(link => {
                    link.addEventListener("mouseover", () => changeBackground(link.getAttribute("data-bg")));
                    link.addEventListener("mouseleave", resetBackground);
                });
            }

            let activeBg = 1;
            function changeBackground(image) {
                if (!image) return;
                const bg1 = document.getElementById("bg1");
                const bg2 = document.getElementById("bg2");
                const newBg = activeBg === 1 ? bg2 : bg1;
                const oldBg = activeBg === 1 ? bg1 : bg2;

                newBg.style.backgroundImage = `url('${image}')`;
                newBg.style.opacity = 1;
                oldBg.style.opacity = 0;
                activeBg = activeBg === 1 ? 2 : 1;
            }

            function resetBackground() {
                 document.getElementById("bg1").style.opacity = 0;
                 document.getElementById("bg2").style.opacity = 0;
            }

            searchInput.addEventListener('input', updateDisplay);
            sortSelect.addEventListener('change', updateDisplay);
            genreSelect.addEventListener('change', updateDisplay);
        });
    </script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const currentPage = location.pathname.split('/').pop();
        const navLinks = document.querySelectorAll('nav a, .navbar a');
        
        navLinks.forEach(link => {
            const linkPage = link.getAttribute('href');
            if (linkPage === currentPage || 
                (currentPage === '' && linkPage === 'index.html') ||
                (currentPage === 'index.html' && linkPage === 'index.html')) {
                link.classList.add('active');
            }
        });
    });
</script>
</body>
</html>
